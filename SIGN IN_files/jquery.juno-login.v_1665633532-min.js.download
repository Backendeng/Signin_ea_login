(function(a,b){a.fn.login=function(l,c){var h={regExEmail:/^[a-z0-9]+[a-z0-9!#$%&'*+/=?^_`{|}~-]*(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/,regExPhoneNumber:/^[-\s\/0-9]+$/,regExEAID:/^[-_a-z0-9]+$/,source:"",ipCountry:"",phoneNumber:"",selectedCountry:"",captchaName:"",loginMethod:"",phoneNumberLoginEnabled:false,legalLoginMethods:[],mergedSvgUri:"/p/static/juno/img/merged_flags.svg",isFromAccountLink:false,fid:"",externalBrowser:false,socialContextPlatform:""};var g=false;var j=false;var e="";var d=new Date().getTime();var k="width=640,height=649,resizable=1";var f={init:function(){a.extend(h,l);if(typeof console==="undefined"||typeof console.log==="undefined"){console={};console.log=function(){}}if(a("#storeKey").val()){f.helpers.tryAutoLogin(a("#email").val().toLowerCase())}if(typeof window.authenticationJsHelper==="undefined"){window.authenticationJsHelper={};window.authenticationJsHelper.currentEnvironment="";window.authenticationJsHelper.online=true;window.authenticationJsHelper.onOfflineLoginSuccess=function(q){console.log("offline success login cid: "+q)};window.authenticationJsHelper.onAuthenticationError=function(q,r){console.log("authentication error: "+q+" with cid: "+r)};window.authenticationJsHelper.fallback=false;window.authenticationJsHelper.onSendTelemetry=function(q){console.log("captcha step: "+q)};window.authenticationJsHelper.showAgeUpFlow=true;window.authenticationJsHelper.supportErrorDescription=false}if(typeof window.authenticationJsHelper.fallback==="undefined"){window.authenticationJsHelper.fallback=false}if(typeof window.authenticationJsHelper.onSendTelemetry==="undefined"){window.authenticationJsHelper.onSendTelemetry=function(q){console.log("captcha step: "+q)}}if(typeof window.authenticationJsHelper.showAgeUpFlow==="undefined"){window.authenticationJsHelper.showAgeUpFlow=true}if(typeof window.authenticationJsHelper.supportErrorDescription==="undefined"){window.authenticationJsHelper.supportErrorDescription=false}window.authenticationJsHelper.fallback=true;addEventListener("message",f.events.receiveMessage);a("body").bind("click",f.events.universalClick);a("body").bind("keyup",f.events.universalKeyUp);a("#back").bind("click",f.events.back);a("#cancel-first-party").bind("click",f.events.cancelFirstParty);a("#login_with_email").bind("click",f.events.loginWithEmail);a("#switch-to-eaid").bind("click",f.events.switchToEAIDLogin);a("#switch-to-eaid").bind("keydown",f.events.switchToEAIDLoginByEntry);a("#switch-to-phone-email").bind("click",f.events.switchToPhoneOrEmailLogin);a("#switch-to-phone-email").bind("keydown",f.events.switchToPhoneOrEmailLoginByEntry);a("#passwordShow").bind("click",f.events.toggleShowPassword);a("#phoneNumberLoginPasswordShow").bind("click",f.events.toggleShowPhoneNumberPassword);a("#loginBase #logInBtn").bind("click.login",f.helpers.debounce(f.events.validateLogin,1000));a("#email").bind("blur.login",f.events.validateEmail);a("#eaid").bind("blur.login",f.events.validateEAID);a("#loginBase #finishBtn").bind("click.finish",f.events.finish);a("#password, #recaptcha_response_field").bind("input change",f.events.resetLoginBtn);a("#forgot-password-section .otka").bind("click.login",f.events.resetPassword);a("#phoneNumber").bind("focus.resetRequest",f.events.clearPhoneNumberError);a("#phoneNumber").bind("keyup",f.events.examineToggleForIdentifier);a("#email").bind("keyup",f.events.examineToggleForIdentifier);a("#phoneNumber").bind("paste",f.events.examineToggleForIdentifier);a("#email").bind("paste",f.events.examineToggleForIdentifier);a("#upgrade_account").bind("click.upgrade",f.events.redirectToUpgrade);a(".region-select-drop-down-option-btn").bind("click",f.events.selectRegionCodeByUI);a(".region-select-drop-down-option-btn").bind("keydown",f.events.navigateRegionCodeOptions);a(".region-select-drop-down-panel").on("click",function(q){q.stopPropagation()});a(".region-select-drop-down-btn").bind("click",f.events.toggleShowRegionCodeOptions);a(".btn-steam-login").bind("click.steam",f.events.steamLogin);a(".btn-steam-login").bind("keydown.steam",f.events.steamLoginByEntry);a(".btn-google-login").bind("click.google",f.events.googleLogin);a(".btn-google-login").bind("keydown.google",f.events.googleLoginByEntry);a(".btn-apple-login").bind("click.apple",f.events.appleLogin);a(".btn-apple-login").bind("keydown.apple",f.events.appleLoginByEntry);a(".btn-facebook-login").bind("click.facebook",f.events.facebookLogin);a(".btn-facebook-login").bind("keydown.facebook",f.events.facebookLoginByEntry);a(".btn-xbox-login").bind("click.xbox",f.events.xboxLogin);a(".btn-xbox-login").bind("keydown.xbox",f.events.xboxLoginByEntry);a(".btn-psn-login").bind("click.psn",f.events.psnLogin);a(".btn-psn-login").bind("keydown.psn",f.events.psnLoginByEntry);a("#createLink").bind("click",f.events.sendCreateRedirectEvent);a(".btn-steam-login, .btn-google-login, .btn-facebook-login, .btn-apple-login, .btn-xbox-login, .btn-psn-login").bind("click",f.events.sendSocialLoginEvent);a(".register").bind("click.register",f.events.register);var m=a("#regionCode");var n=a("#phoneNumber");m.bind("change.login",f.events.resetRegionCode);n.bind("keyup.login change.login",f.events.resetRegionCode);f.helpers.initDefaultCountry();f.events.resetRegionCode();f.events.updateUIByRegionCode();a("#tooltip svg").hover(function(){a(this).siblings(".otktooltip-bottom").addClass("otktooltip-isvisible")},function(){a(this).siblings(".otktooltip-bottom").removeClass("otktooltip-isvisible")});a(".otktooltip-withcontent").focus(function(){a(this).find("svg")[0].classList.add("otktooltip-svg-focus");a(this).children(".otktooltip-bottom").addClass("otktooltip-isvisible")});a(".otktooltip-withcontent").focusout(function(){a(this).find("svg")[0].classList.remove("otktooltip-svg-focus");a(this).children(".otktooltip-bottom").removeClass("otktooltip-isvisible")});a("span.otkicon-closecircle").bind("click.login",f.events.closeBanner);a("#loginBase input").bind("keydown.login",f.events.captureFieldEntry);f.helpers.showPanel("#login-with-OriginId-or-Email-panel");if(h.loginMethod==="phoneNumberPassword"){a("#toggle-form-email-input").hide();a("#toggle-form-phone-number-input").show();a("#phoneNumber").focus()}else{a("#toggle-form-phone-number-input").hide();a("#toggle-form-email-input").show();a("#email").focus()}if(h.phoneNumberLoginEnabled){if(h.loginMethod==="eaidPassword"){f.helpers.prepareEAIDLoginView();a("#email").val("")}else{f.helpers.preparePhoneOrEmailLoginView();a("#eaid").val("")}}if(h.isFromAccountLink){f.helpers.resetAccountLinkLoginView()}var o=a("#errorCode").val();var p=a("#errorCodeWithDescription").val();if(a("#online-general-error > p").text().length>0){if(o=="10001"){f.helpers.tryOfflineLogin(o,a("#email").val().toLowerCase())}else{if(h.loginMethod==="eaidPassword"&&a("#eaid").is(":visible")){f.helpers.inputErrorAddOrRemove(a(".otkinput-grouped").has("#eaid"),"add")}else{if(h.loginMethod==="phoneNumberPassword"){f.helpers.inputErrorAddOrRemove(a(".otkinput-grouped").has("#phoneNumber"),"add")}else{f.helpers.inputErrorAddOrRemove(a(".otkinput-grouped").has("#email"),"add")}}f.helpers.inputErrorAddOrRemove(a(".otkinput-grouped").has("#password"),"add");a("#online-general-error").addClass("otkform-group-haserror");f.helpers.removeKeyedData(a("#email").val().toLowerCase());if(o=="10004"){window.authenticationJsHelper.onSendTelemetry(5)}else{if(o=="10003"&&p!=""&&window.authenticationJsHelper.supportErrorDescription){window.authenticationJsHelper.onAuthenticationError(p,"")}else{window.authenticationJsHelper.onAuthenticationError(o,"")}}if(o=="10002"){if(f.helpers.isRecaptchaShown()){window.authenticationJsHelper.onSendTelemetry(4)}a("#password").val("").focus()}}}else{if(o){if(o=="10003"&&p!=""&&window.authenticationJsHelper.supportErrorDescription){window.authenticationJsHelper.onAuthenticationError(p,"")}else{window.authenticationJsHelper.onAuthenticationError(o,"")}}}f.helpers.displayBannerBox();f.helpers.displayLoginValues();a("#createNav, #forget-password").mousedown(function(q){q.preventDefault();if(q.which==1){a.fn.pin.helpers.postUIInteractionMessageOnClick(q.target.id);window.location=a(this).attr("href")}});g=true},events:{receiveMessage:function(p){if(new URL(p.origin).origin!==new URL(l.origin).origin){return}if(!p.data||!p.data.state){return}var o=a("#login-with-first-party-form");for(var n in p.data){if(p.data.hasOwnProperty(n)){o.find('input[name="'+n+'"]').remove();var m=a("<input>").attr("type","hidden").attr("name",n).val(p.data[n]);o.append(m)}}o.submit()},universalClick:function(m){a(".region-select-drop-down-panel").hide()},universalKeyUp:function(m){var o=new Date().getTime();if(o-d>1000){e=""}d=o;e=e+String.fromCharCode(m.keyCode);if(a(".region-select-drop-down-panel").is(":visible")){var n=a(".region-select-drop-down-panel .region-select-drop-down-option-btn");if(a(n[0]).attr("data-region-code")===b){n.each(function(q,r){var p=a(r).attr("data-region-code-value").trim();p=p.substring(p.indexOf("+")+1,p.length-1);a(r).attr("data-region-code",p)})}n.each(function(p,q){if(a(q).attr("data-region-code-value").toUpperCase().startsWith(e)||a(q).attr("data-region-code")===e){a(".region-select-drop-down-inner-panel").animate({scrollTop:a(q).offset().top-a(n[0]).offset().top-10},300);a(q).focus();return false}})}},back:function(m){m.preventDefault();a("#back-form").submit()},cancelFirstParty:function(m){m.preventDefault();a("#back-form").submit()},redirectToUpgrade:function(m){m.preventDefault();a("#back-to-upgrade-form").submit()},completeLoginInBrowser:function(){window.location=window.location+"&_eventId=completeLogin"},loginWithEmail:function(m){m.preventDefault();a("#login-with-email-form").submit()},switchToEAIDLogin:function(m){m.preventDefault();f.helpers.prepareEAIDLoginView();f.helpers.clearPasswordError();f.helpers.updateCurrentLoginMethod();a("#eaid").focus()},switchToEAIDLoginByEntry:function(m){if(m.which==13){m.preventDefault();a(this).click()}},switchToPhoneOrEmailLogin:function(m){m.preventDefault();f.helpers.preparePhoneOrEmailLoginView();f.helpers.clearPasswordError();f.helpers.updateCurrentLoginMethod();a("#email").focus()},switchToPhoneOrEmailLoginByEntry:function(m){if(m.which==13){m.preventDefault();a(this).click()}},steamLogin:function(o){o.preventDefault();var p=a('input[name="rememberMe"]').is(":checked");var n=a('input[name="loginInvisible"]').is(":checked");if(n===b){n=false}var m=location.href;if(m.indexOf("/juno/login")<m.indexOf("?")){m=m.replace("/juno/login","/juno/redirectSteam")}if(h.externalBrowser==="true"){window.open(m+"&external_browser=true&fid="+h.fid+"&rememberme="+p+"&login_invisible="+n,"windowSteamSignIn",k);f.events.completeLoginInBrowser()}else{window.open(m,"windowSteamSignIn",k)}},steamLoginByEntry:function(m){if(m.which==13){m.preventDefault();a(this).click()}},googleLogin:function(o){o.preventDefault();var p=a('input[name="rememberMe"]').is(":checked");var n=a('input[name="loginInvisible"]').is(":checked");if(n===b){n=false}var m=location.href;if(m.indexOf("/juno/login")<m.indexOf("?")){m=m.replace("/juno/login","/juno/redirectGoogle")}if(h.externalBrowser==="true"){window.open(m+"&external_browser=true&fid="+h.fid+"&rememberme="+p+"&login_invisible="+n,"windowGoogleSignIn",k);f.events.completeLoginInBrowser()}else{window.open(m,"windowGoogleSignIn",k)}},googleLoginByEntry:function(m){if(m.which==13){m.preventDefault();a(this).click()}},facebookLogin:function(o){o.preventDefault();var p=a('input[name="rememberMe"]').is(":checked");var n=a('input[name="loginInvisible"]').is(":checked");if(n===b){n=false}var m=location.href;if(m.indexOf("/juno/login")<m.indexOf("?")){m=m.replace("/juno/login","/juno/redirectFacebook")}if(h.externalBrowser==="true"){window.open(m+"&external_browser=true&fid="+h.fid+"&rememberme="+p+"&login_invisible="+n,"windowFacebookSignIn",k);f.events.completeLoginInBrowser()}else{window.open(m,"windowFacebookSignIn",k)}},facebookLoginByEntry:function(m){if(m.which==13){m.preventDefault();a(this).click()}},appleLogin:function(o){o.preventDefault();var p=a('input[name="rememberMe"]').is(":checked");var n=a('input[name="loginInvisible"]').is(":checked");if(n===b){n=false}var m=location.href;if(m.indexOf("/juno/login")<m.indexOf("?")){m=m.replace("/juno/login","/juno/redirectApple")}if(h.externalBrowser==="true"){window.open(m+"&external_browser=true&fid="+h.fid+"&rememberme="+p+"&login_invisible="+n,"windowAppleSignIn",k);f.events.completeLoginInBrowser()}else{window.open(m,"windowAppleSignIn",k)}},appleLoginByEntry:function(m){if(m.which==13){m.preventDefault();a(this).click()}},xboxLogin:function(o){o.preventDefault();var p=a('input[name="rememberMe"]').is(":checked");var n=a('input[name="loginInvisible"]').is(":checked");if(n===b){n=false}var m=location.href;if(m.indexOf("/juno/login")<m.indexOf("?")){m=m.replace("/juno/login","/juno/redirectXbox")}if(h.externalBrowser==="true"){window.open(m+"&external_browser=true&fid="+h.fid+"&rememberme="+p+"&login_invisible="+n,"windowXboxSignIn",k);f.events.completeLoginInBrowser()}else{window.open(m,"windowXboxSignIn",k)}},xboxLoginByEntry:function(m){if(m.which==13){m.preventDefault();a(this).click()}},psnLogin:function(o){o.preventDefault();var p=a('input[name="rememberMe"]').is(":checked");var n=a('input[name="loginInvisible"]').is(":checked");if(n===b){n=false}var m=location.href;if(m.indexOf("/juno/login")<m.indexOf("?")){m=m.replace("/juno/login","/juno/redirectPsn")}if(h.externalBrowser==="true"){window.open(m+"&external_browser=true&fid="+h.fid+"&rememberme="+p+"&login_invisible="+n,"windowPsnSignIn",k);f.events.completeLoginInBrowser()}else{window.open(m,"windowPsnSignIn",k)}},psnLoginByEntry:function(m){if(m.which==13){m.preventDefault();a(this).click()}},sendSocialLoginEvent:function(m){sendGAJunoEvent("Social_Button_Click",a(m.target).attr("class").split(" ")[1]);setGAJunoCustomDimension("dimension1",h.socialContextPlatform);sendGAJunoPageView("/juno/login/socialButtonClick");var n=a(m.target).attr("class").split(" ")[1].split("-")[1];a.fn.pin.helpers.postUIInteractionMessageOnClick(n,b,true,{login_method:""})},sendCreateRedirectEvent:function(m){a.fn.pin.helpers.postUIInteractionMessageOnClick(m.target.id,b,true,{login_method:""})},register:function(m){m.preventDefault();a("#register-form").submit()},clearPhoneNumberError:function(m){f.helpers.inputErrorAddOrRemove(a("#phoneNumber").parents(".otkinput-grouped"),"remove")},toggleShowPassword:function(n){n.preventDefault();var m=a(this).siblings("#password");sendGAJunoEvent("Login","Toggle password");if(m.attr("type")==="text"){m.prop("type","password");a("#showIcon").removeClass("hide-icon");a("#hideIcon").addClass("hide-icon")}else{m.prop("type","text");a("#showIcon").addClass("hide-icon");a("#hideIcon").removeClass("hide-icon")}},toggleShowPhoneNumberPassword:function(n){n.preventDefault();var m=a(this).siblings("#phoneNumberLoginPassword");sendGAJunoEvent("Login","Toggle phone password");if(m.attr("type")==="text"){m.prop("type","password");m.siblings("span").text(a("#form-password-show-text").text())}else{m.prop("type","text");m.siblings("span").text(a("#form-password-hide-text").text())}},resetPassword:function(m){m.preventDefault();if(!window.opener){if(top==self){window.location=a(this).attr("href")}else{window.open(a(this).attr("href"),"_parent")}}else{window.location=a(this).attr("href")}},resetLoginBtn:function(m){if(m.target.id==="recaptcha_response_field"){a("#captcha-container p").removeClass("otkform-group-haserror");a("#recaptcha_response_field").removeClass("otkform-group-haserror")}if(h.source==="WEB"&&a("#loginMethod").val()==="emailPassword"&&!f.helpers.validateEmail(a("#email"))){f.helpers.inputErrorShow("email",a("#email-invalid-text").text())}return true},validateEmail:function(n){if(!g){return}if(a("#email").val()===""){return}if(a("#switch-to-eaid:hover").length>0){return}n.preventDefault();var m=a("#email");if(a("#loginMethod").val()==="phoneNumberPassword"){return}if(h.source==="PC"&&!h.phoneNumberLoginEnabled){if(!(f.helpers.validateEmail(m)||f.helpers.validateEAID(m))){sendGAJunoEvent("Login","Invalid email");f.helpers.inputErrorShow("email",a("#email-invalid-text").text())}else{f.helpers.removeErrorMessageAndRecoverInputStyle("email")}return}if(!f.helpers.validateEmail(m)){sendGAJunoEvent("Login","Invalid email");f.helpers.inputErrorShow("email",a("#email-invalid-text").text())}else{f.helpers.removeErrorMessageAndRecoverInputStyle("email")}},validateEAID:function(n){if(!g){return}n.preventDefault();var m=a("#eaid");f.helpers.removeErrorMessageAndRecoverInputStyle("eaid");if(f.helpers.validateIsEmpty(m)){return false}if(!f.helpers.validateEAID(m)){sendGAJunoEvent("Login","Invalid EA ID");f.helpers.inputErrorShow("eaid",a("#ea-id-invalid-text").text())}},validateLogin:function(p){f.helpers.updateCurrentLoginMethod();var q=a("#loginMethod").val();a.fn.pin.helpers.postUIInteractionMessageOnClick(p.target.id,b,true,{login_method:q});if(q==="phoneNumberPassword"){if(!f.events.validatePhoneNumberLogin(p)){return false}sendGAJunoEvent("Login","Login with phone number")}else{p.preventDefault();f.helpers.removeOrAddError("remove");a("#online-general-error, #offline-auth-error").removeClass("otkform-group-haserror");var o=a("#email");var m=a("#eaid");var n=a("#password");if((f.helpers.validateIsEmpty(o)&&f.helpers.validateIsEmpty(m))||f.helpers.validateIsEmpty(n)){sendGAJunoEvent("Login","Empty email/password")}if(q==="emailPassword"){if(!f.helpers.validateEmail(o)){sendGAJunoEvent("Login","Invalid email");f.helpers.inputErrorShow("email",a("#email-invalid-text").text());return false}sendGAJunoEvent("Login","Login with email")}else{if(q==="eaidPassword"){if(m.is(":visible")){if(!f.helpers.validateEAID(m)){sendGAJunoEvent("Login","Invalid EA ID");f.helpers.inputErrorShow("eaid",a("#ea-id-invalid-text").text());return false}}else{if(!f.helpers.validateEAID(o)){sendGAJunoEvent("Login","Invalid EA ID");f.helpers.inputErrorShow("email",a("#ea-id-invalid-text").text());return false}}sendGAJunoEvent("Login","Login with EA ID")}}if(f.helpers.validateIsEmpty(n)){f.helpers.showError(a("#email-password-empty-text").text());return false}if(h.captchaName==="googlecaptcha"||h.captchaName==="invisiblegooglecaptcha"){if(f.helpers.validateIsEmpty(a("#g-recaptcha-response"))){sendGAJunoEvent("Create","Empty google captcha");f.helpers.toggleErrorMessage(a("#form-error-google-recaptcha-missing"),"add");a("#basicInfoNextBtn").removeClass("disabled");return}else{f.helpers.toggleErrorMessage(a("#form-error-google-recaptcha-missing"),"remove");a("#thirdPartyCaptchaResponse").val(a("#g-recaptcha-response").val());a(".g-recaptcha").remove()}}else{if(h.captchaName==="funcaptcha"){if(f.helpers.validateIsEmpty(a("#funcaptcha-solved"))){sendGAJunoEvent("Create","Empty fun captcha");f.helpers.toggleErrorMessage(a("#form-error-funcaptcha-missing"),"add");a("#basicInfoNextBtn").removeClass("disabled");return}else{a("#funcaptcha").remove()}}}if(window.authenticationJsHelper.online){f.helpers.loginOnline(o.val().toLowerCase(),n.val())}else{f.helpers.loginOffline(o.val().toLowerCase(),n.val())}}},finish:function(m){m.preventDefault();a("#login-form").submit()},validatePhoneNumberLogin:function(o){o.preventDefault();f.helpers.removeOrAddError("remove");a("#online-general-error, #offline-auth-error").removeClass("otkform-group-haserror");var n=a("#phoneNumber");var m=a("#password");if(f.helpers.validateIsEmpty(m)){sendGAJunoEvent("Login","Empty password");f.helpers.showError(a("#email-password-empty-text").text());return false}if(window.authenticationJsHelper.online){f.helpers.phoneNumberLoginOnline(n.val(),m.val())}else{}return true},resetRegionCode:function(){var m=a("#regionCode");var n=f.helpers.unicodeSubString(m.find("option:selected").text(),40);if(m.val()==="0"){m.siblings(".otkselect-selected").text("");m.siblings(".otkselect-placeholder").text("(+)")}else{if(m.val()==="IO"){m.siblings(".otkselect-selected").text("(+246)");m.siblings(".otkselect-placeholder").text("")}else{if(m.val()==="GS"){m.siblings(".otkselect-selected").text("(+500)");m.siblings(".otkselect-placeholder").text("")}else{if(m.val()==="UM"){m.siblings(".otkselect-selected").text("(+1)");m.siblings(".otkselect-placeholder").text("")}else{n=n.match(/\(\+[0-9]+\)/g);m.siblings(".otkselect-selected").text(n);m.siblings(".otkselect-placeholder").text("")}}}}},updateUIByRegionCode:function(){var m=a("#regionCode");if(m.val()==="0"){m.val("US")}a("#region-code-"+m.val()).click()},validateIsNumber:function(m){if(!(m.keyCode==46)&&!(m.keyCode==8)&&!(m.keyCode==37)&&!(m.keyCode==39)){if(!((m.keyCode>=48&&m.keyCode<=57)||(m.keyCode>=96&&m.keyCode<=105))){m.preventDefault()}}},cancelTFA:function(m){m.preventDefault();a(".login-container").removeClass("field-error");a("#login-form #_eventId").val("cancel");a("#login-form").submit()},captureFieldEntry:function(m){if(m.which==13){m.preventDefault();a("#logInBtn").click()}},selectRegionCodeByUI:function(m){m.preventDefault();m.stopPropagation();var n=a(m.target);f.helpers.selectRegionCodeByUI(n);a(".region-select-drop-down-panel").hide();a("#phoneNumber").focus()},toggleShowRegionCodeOptions:function(n){n.preventDefault();n.stopPropagation();var o=a(".region-select-drop-down-panel");o.toggle();if(o.is(":visible")){var m=a(".region-select-drop-down-option-container").has(".region-select-drop-down-option-btn-selected");if(m.length===1){f.helpers.scrollTo(m);a(".region-select-drop-down-option-btn-selected").focus()}}},navigateRegionCodeOptions:function(r){if(!a(".region-select-drop-down-panel").is(":visible")){return true}var p=a(r.target);if(r.which===38){r.preventDefault();r.stopPropagation();var o=p.parents().filter(".region-select-drop-down-option-container").prev().find(".region-select-drop-down-option-btn");if(o.length===1){o.focus()}else{var n=a(".region-select-drop-down-option-container").eq(-1).find(".region-select-drop-down-option-btn");n.focus()}}else{if(r.which===40){r.preventDefault();r.stopPropagation();var m=p.parents().filter(".region-select-drop-down-option-container").next().find(".region-select-drop-down-option-btn");if(m.length===1){m.focus()}else{var q=a(".region-select-drop-down-option-container").eq(0).find(".region-select-drop-down-option-btn");q.focus()}}else{if(r.which===27){a(".region-select-drop-down-panel").hide()}}}},examineToggleForIdentifier:function(n){if(!h.phoneNumberLoginEnabled){return true}var m=a(n.target);if(h.regExPhoneNumber.test(m.val())){a("#toggle-form-email-input").hide();a("#toggle-form-phone-number-input").show();if(n.type!=="blur"){a("#phoneNumber").val(m.val()).focus()}f.helpers.loadFlagSvgs()}else{a("#toggle-form-phone-number-input").hide();a("#toggle-form-email-input").show();if(n.type!=="blur"){a("#email").val(m.val()).focus()}}f.helpers.updateCurrentLoginMethod();f.helpers.removeErrorMessageAndRecoverInputStyle("email");return true}},helpers:{showPanel:function(m){a("#reg-form > div").css("display","none");switch(m){case"#login-with-OriginId-or-Email-panel":sendGAJunoPageView("/juno/loginWithEmail");f.helpers.resetLoginWithOriginIdOrEmailPanel();break}a("#createBase").scrollTop(0)},resetLoginWithOriginIdOrEmailPanel:function(){a("#back").hide();a("#login-with-OriginId-or-Email-panel").css("display","block");a("#loginWithOriginIDTitle").css("display","block")},resetAccountLinkLoginView:function(){a("#back").hide();a("#login-with-OriginId-or-Email-panel").css("display","block");a("#loginWithOriginIDTitle").css("display","none")},initDefaultCountry:function(){var n=h.selectedCountry;if(n==""){n=h.ipCountry}if(n!=""){var m=a("#regionCode");m.find("option").each(function(){if(a(this).attr("value")===n){m.val(n);return false}})}},unicodeSubString:function(o,m){var n=document.documentElement.lang;if("ru"===n||"th"===n){m*=1.7}if(o.replace(/[^\x00-\xff]/g,"00").length<=m){return o}while(o.replace(/[^\x00-\xff]/g,"00").length>m){o=o.substring(0,o.length-2)}return o+"..."},errorAddOrRemove:function(n,m){if(m==="add"){n.addClass("otkinput-errormsg");n.show()}else{n.removeClass("otkinput-errormsg");n.hide()}},toggleErrorMessage:function(n,m){if(m==="add"){n.addClass("otkform-group-haserror")}else{n.removeClass("otkform-group-haserror")}},inputErrorAddOrRemove:function(n,m){if(m==="add"){n.addClass("otkinput-iserror")}else{n.removeClass("otkinput-iserror")}},inputErrorShow:function(m,n){var o=a(".otkinput-grouped").has("#"+m);f.helpers.inputErrorAddOrRemove(o,"add");var p="#online-input-error-"+m;a(p+" .otkc").text(n);a(p).addClass("otkform-group-haserror")},showError:function(m){f.helpers.removeOrAddError("add");a("#online-general-error .otkc").text(m);a("#online-general-error").addClass("otkform-group-haserror")},clearSeverError:function(){a(".otkform-group-haserror").css("display","none")},validateEmail:function(m){return h.regExEmail.test(a(m).val().trim().toLowerCase())},validateEAID:function(m){return h.regExEAID.test(a(m).val().trim().toLowerCase())},validateIsEmpty:function(m){if(a(m).attr("type")=="checkbox"){if(!a(m).is(":checked")){a(m).removeClass("checked");return true}else{a(m).addClass("checked");return false}}return a(m).val()==""},removeOrAddError:function(m){if(m==="remove"){a(".otkinput-grouped").removeClass("otkinput-iserror")}else{a(".otkinput-grouped").addClass("otkinput-iserror")}},callService:function(o,m,p){var n=h.contextPath+"/ajax";$hr=a.ajax(a.extend(m,{url:n+o,dataType:"json",timeout:3000,cache:false,data:a.extend({requestorId:"portal"},p),error:function(q,s,r){a("#regViews").css("display","none");a("#panel-connection-error").css("display","block")}}))},loginOnline:function(o,m){var n=this.getCredentialsKey(o,m);this.storeKeyedData(o,n);var p=this.storeCidData(n,this.randomString());this.storeOtherLoginValue();a("#cid").val(p);a("#showAgeUp").val(window.authenticationJsHelper.showAgeUpFlow);a("#login-form").submit()},phoneNumberLoginOnline:function(n,m){var o=this.getCredentialsKey(n,m);this.storeKeyedData(n,o);var p=this.storeCidData(o,this.randomString());this.storeOtherLoginValue();a("#cid").val(p);a("#showAgeUp").val(window.authenticationJsHelper.showAgeUpFlow);a("#login-form").submit()},loginOffline:function(m,n){console.log("begin loginOffline");var o=this.getLocalStorageItem(m);console.log("offline old key: "+o+" with user:"+m);if(o){var p=this.getCredentialsKey(m,n);console.log("offline new key: "+p);var q=this.loadCidData(p);console.log("login offline cid: "+q);if(q){this.setLocalStorageItem("offlineLoginDisplay",m);window.authenticationJsHelper.onOfflineLoginSuccess(q)}else{a("#password").val("");f.helpers.removeOrAddError(a("#offline-auth-error"),"add");this.removeLocalStorageItem("offlineLoginDisplay");window.authenticationJsHelper.onAuthenticationError("10002","")}}else{a("#password").val("");f.helpers.removeOrAddError("add");a("#offline-general-error").addClass("otkform-group-haserror");this.removeLocalStorageItem("offlineLoginDisplay");window.authenticationJsHelper.onAuthenticationError("10002","")}},storeOtherLoginValue:function(){this.setLocalStorageItem("loginInvisible",a("#loginInvisible").attr("checked"))},tryAutoLogin:function(m){console.log("try auto login: "+m);a(".form-container").hide();var n=this.getLocalStorageItem(m);if(n){console.log("autologin key: "+n);a("#login-form").submit()}else{a(".form-container").show()}},tryOfflineLogin:function(q,o){console.log("try offline login!");var p=this.getLocalStorageItem(o);if(p){var m=this.getLocalStorageItem(p);if(m){var n=m.split(",");if(n[1]!=""){if(q=="10003"&&errorCodeWithDescription!=""&&window.authenticationJsHelper.supportErrorDescription){window.authenticationJsHelper.onAuthenticationError(errorCodeWithDescription,m)}else{window.authenticationJsHelper.onAuthenticationError(q,m)}}else{a("#online-general-error").removeClass("general-error");a("#online-general-error").addClass("red-box-error");a(".login-container").addClass("field-error");f.helpers.removeKeyedData(a("#email").val().toLowerCase())}}}},randomString:function(){var p="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var m=32;var n="";for(var o=0;o<m;o++){var q=Math.floor(Math.random()*p.length);n+=p.substring(q,q+1)}return n},removeKeyedData:function(n){var m=this.getLocalStorageItem(n);if(m){this.removeLocalStorageItem(m);var o=this.getLocalStorageItem("oldKey");if(o){this.setLocalStorageItem(n,o);this.removeLocalStorageItem("oldKey")}else{this.removeLocalStorageItem(n)}this.removeLocalStorageItem("latestSuccessLogin");this.removeLocalStorageItem("offlineLoginDisplay")}},storeKeyedData:function(m,o){if(m){var n=this.getLocalStorageItem(m);if(n){if(n==o){this.setLocalStorageItem("latestSuccessLogin",m)}else{this.setLocalStorageItem("latestSuccessLogin",null);this.setLocalStorageItem("oldKey",n)}}else{this.setLocalStorageItem("latestSuccessLogin",null)}this.setLocalStorageItem(m,o);this.setLocalStorageItem("offlineLoginDisplay",m)}},storeCidData:function(p,o){var r="";var n=this.getLocalStorageItem(p);var m=new Array(String);var q=new Array(String);if(n){q=n.split(",");if(q[1]==""){m[0]=q[0]}else{m[0]=q[1]}m[1]=o;r=m[0]+","+m[1]}else{m[0]=o;m[1]="";r=m[0]}this.setLocalStorageItem(p,m.join(","));return r},loadCidData:function(o){var p="";if(o){var m=this.getLocalStorageItem(o);if(m){var n=m.split(",");if(n[1]!=""){p=n[0]+","+n[1]}else{p=n[0]}}}return p},getCredentialsKey:function(r,o){var q="";var n=this.getNormalizedKey(r);var m=this.getNormalizedKey(o);if(n&&m){var p=new jsSHA(n+m+window.authenticationJsHelper.currentEnvironment,"ASCII");q=p.getHash("SHA-512","HEX")}return q},displayBannerBox:function(){var m=a("#bannerType").val();var n=a("#bannerText").val();if(m&&n){n=new DOMParser().parseFromString(n,"text/html").documentElement.textContent;if(m=="error"){a("#junoBannerBox").addClass("otknotice-error").find("strong").text(n);a("#junoBannerBox").show()}else{if(m=="info"){a("#junoBannerBox").addClass("otknotice-passive").find("strong").text(n);a("#junoBannerBox").show()}else{if(m=="caution"){a("#junoBannerBox").addClass("otknotice-warning").find("strong").text(n);a("#junoBannerBox").show()}}}}},displayLoginValues:function(){var m=this.getLocalStorageItem("loginInvisible");if(m=="checked"){a("#loginInvisible").prop("checked",true)}},setLocalStorageItem:function(m,n){localStorage.setItem(this.getNormalizedKey(m),n)},getLocalStorageItem:function(m){return localStorage.getItem(this.getNormalizedKey(m))},removeLocalStorageItem:function(m){localStorage.removeItem(this.getNormalizedKey(m))},getNormalizedKey:function(m){return a.trim(m)},isRecaptchaShown:function(){var m=a("#captcha-container").html();m=m.replace(/[\r\n]/g,"").replace(/[ ]/g,"");return(m!="")},prepareEAIDLoginView:function(){a("#email-phone-login-div").hide();a("#email-phone-login-div input").prop("disabled",true);a("#eaid-login-div input").prop("disabled",false);a("#eaid-login-div").show();a("#switch-to-eaid").hide();a("#switch-to-phone-email").show()},preparePhoneOrEmailLoginView:function(){a("#eaid-login-div").hide();a("#eaid-login-div input").prop("disabled",true);a("#email-phone-login-div input").prop("disabled",false);a("#email-phone-login-div").show();a("#switch-to-phone-email").hide();a("#switch-to-eaid").show()},clearPasswordError:function(){f.helpers.inputErrorAddOrRemove(a(".otkinput-grouped").has("#password"),"remove");a("#online-general-error").removeClass("otkform-group-haserror");a("#online-general-error .otkc").text("")},removeErrorMessageAndRecoverInputStyle:function(m){f.helpers.inputErrorAddOrRemove(a(".otkinput-grouped").has("#"+m),"remove");f.helpers.inputErrorAddOrRemove(a(".otkinput-grouped").has("#password"),"remove");var n="#online-input-error-"+m;a(n+", #online-general-error, #offline-auth-error").removeClass("otkform-group-haserror");a(n+" .otkc, #online-general-error .otkc").text("")},updateCurrentLoginMethod:function(o){var n=a("#loginMethod");if(o&&h.legalLoginMethods.includes(o)){n.val(o)}else{for(var m in f.helpers.loginMethodPredicates){if(h.legalLoginMethods.includes(m)&&f.helpers.loginMethodPredicates[m]()){n.val(m);return}}}console.log("ERROR: no login method matched, using the original one: "+n.val())},loginMethodPredicates:{phoneNumberPassword:function(){return a("#phoneNumber").is(":visible")&&a("#password").is(":visible")},emailPassword:function(){var m=a("#email");if(h.source==="PC"){if(h.phoneNumberLoginEnabled){if(m.is(":visible")||a("#prepopulate-email").length>0){return(a("#password").is(":visible"))}}else{return m.is(":visible")&&!f.helpers.validateEAID(m)&&a("#password").is(":visible")}}else{if(h.phoneNumberLoginEnabled){if(m.is(":visible")||a("#prepopulate-email").length>0){return(a("#password").is(":visible"))}}else{return m.is(":visible")&&a("#password").is(":visible")}}return false},eaidPassword:function(){if(h.source==="PC"){if(h.phoneNumberLoginEnabled){var n=a("#eaid");return n.is(":visible")&&a("#password").is(":visible")}else{var m=a("#email");return m.is(":visible")&&f.helpers.validateEAID(m)&&a("#password").is(":visible")}}return false},},selectRegionCodeByUI:function(q){var n=q.attr("data-region-code-key");var p=q.attr("data-region-code-value");var o=/.*\((\+[0-9]+)\).*/.exec(p)[1];var m=a("#regionCode");m.val(n);m.find("option").prop("selected",false);m.find('option[value="'+n+'"]').prop("selected",true);a(".region-select-drop-down-btn > .quantum-input-icon").html(a("#region-flag-"+n).html());a(".region-select-drop-down-btn > .quantum-input-icon-2").html(o);a(".region-select-drop-down-option-btn").removeClass("region-select-drop-down-option-btn-selected");a("#region-code-"+n).addClass("region-select-drop-down-option-btn-selected")},scrollTo:function(n,r,o){var p=a(n);var m="";var q="";if(r===b){m=p.siblings().eq(0)}else{m=a(r)}if(o===b){q=p.parent()}else{q=a(o)}if(p.prev()===b||p[0]===m[0]){q.animate({scrollTop:0},300)}else{q.animate({scrollTop:p.offset().top-m.offset().top-10},300)}},loadFlagSvgs:function(){if(j||h.mergedSvgUri==="#"){return}j=true;a.ajax({dataType:"text",url:h.mergedSvgUri,success:function(m){a("#hidden-svg-container").html(m)},error:function(m,o,n){console.log(m);console.log(o);console.log(n)}})},debounce:function(n,m){var o=null;return function(p){if(!o){n.call(null,p)}else{clearTimeout(o)}o=setTimeout(function(){clearTimeout(o);o=null},m)}}}};var i=["init"];if(typeof l==="object"||!l){originWrapper.wrapWithWebChannel().then(f.init)}else{if(a.inArray(l,i)){}}}})(jQuery);